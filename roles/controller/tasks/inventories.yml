---
- name: Create localhost inventory
  ansible.controller.inventory:
    name: localhost
    description: localhost
    organization: "{{ awx_organization }}"
    state: present
  register: localhost_inventory
  tags:
    - inventories

- name: Add localhost host to inventory
  ansible.controller.host:
    name: localhost
    inventory: "{{ localhost_inventory.name }}"
    state: present
  tags:
    - inventories

- name: Create Azure Inventory
  ansible.controller.inventory:
    name: Azure
    description: Azure Inventory
    organization: "{{ awx_organization }}"
    state: present
  register: azure_inventory
  when:
    - (seed_lab_content | bool)
  tags:
    - inventories
    - azure

- name: Add Azure inventory source
  ansible.controller.inventory_source:
    name: Azure Dynamic Inventory
    description: Creates inventory from Azure sources
    inventory: "{{ azure_inventory.name }}"
    credential: "{{ azure_credential.name }}"
    execution_environment: "{{ cloud_services_ee.name }}"
    overwrite: true
    update_on_launch: true
    organization: "{{ awx_organization }}"
    source: scm
    source_project: "{{ content_lab_project_azure.name }}"
    source_path: inventory/inventory.azure_rm.yml
    verbosity: 0
  when:
    - (seed_lab_content | bool)
  tags:
    - inventories
    - azure
